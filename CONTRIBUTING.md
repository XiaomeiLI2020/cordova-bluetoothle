Quick Start
-----------

This project is mainly a test runner app which uses the plugin (which is in the
src/ directory). To go from a fresh `git clone` to seeing the test runner
working on a device:

```sh
./build ios  # or: ./build android
./server
# plug an iOS or Android device in to your computer, then:
./run
```

The plugin contains native code for Android and iOS as well as JavaScript code.
Guides for hacking on each of these environments are below:


iOS Development
---------------

### Dependencies

1. A computer running OS X
2. [Xcode](https://developer.apple.com/xcode/download/)
  - Xcode 7.2 was used as of this writing
3. `./build ios`
  - Generates the Xcode project (in the testrunner/ directory) and downloads
    all required dependencies

### Open

Open the project in Xcode by clicking File -> Open... from the main menu, then
choosing
`<path-to-project>/testrunner/platforms/ios/BluetoothleTestRunner.xcodeproj`.

### Relevant Files

The iOS components of the com.mutualmobile.cordova.bluetoothle plugin are
located in:

- testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BaseReturnObjectType.h
- testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BaseReturnObjectType.m
- testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BluetoothLePlugin.h
- testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BluetoothLePlugin.m

Which are actually symbolic links:

```
$ find testrunner/platforms/ios -type l | xargs ls -lha

lrwxr-xr-x  1 zach.shipley  staff    48B Feb  2 11:28 testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BaseReturnObjectType.h -> ../../../../../../src/ios/BaseReturnObjectType.h
lrwxr-xr-x  1 zach.shipley  staff    48B Feb  2 11:28 testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BaseReturnObjectType.m -> ../../../../../../src/ios/BaseReturnObjectType.m
lrwxr-xr-x  1 zach.shipley  staff    45B Feb  2 11:28 testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BluetoothLePlugin.h -> ../../../../../../src/ios/BluetoothLePlugin.h
lrwxr-xr-x  1 zach.shipley  staff    45B Feb  2 11:28 testrunner/platforms/ios/BluetoothleTestRunner/Plugins/com.mutualmobile.cordova.bluetoothle/BluetoothLePlugin.m -> ../../../../../../src/ios/BluetoothLePlugin.m
```

So updating them from Xcode will update the plugin files in the src/ directory.
We do it this way to avoid version-controlling the entire testrunner/ directory
(the vast majority of which is code we did not write and is generated by the
`./build` script).

### Running

1. Make sure `./server` is running in a Terminal window
2. Plug an iOS device in to your computer
3. Click Product -> Run from the main Xcode menu


Android Development
-------------------

### Dependencies

1. A computer running Linux or OS X
2. [Android Studio](http://developer.android.com/sdk/index.html)
  - Android Studio 1.5.1 was used as of this writing
3. `./build android`
  - Generates the Android project (in the testrunner/ directory) and downloads
    all required dependencies, including Android SDK components

### Open

Open the project in Android Studio:

**From the welcome screen:** Click "Open an existing Android Studio project"
and choose `<path-to-project>/testrunner/platforms/android`.

**From anywhere else:** Click File -> Open... from the main menu, then choose
`<path-to-project>/testrunner/platforms/android`.

### Relevant Files

The Android components of the com.mutualmobile.cordova.bluetoothle plugin are
located in:

- testrunner/platforms/android/src/com/mutualmobile/cordova/bluetoothle/BluetoothLePlugin.java
- testrunner/platforms/android/src/com/mutualmobile/cordova/bluetoothle/JSONObjects.java

The above are actually symbolic links:

```
$ find testrunner/platforms/android -type l | xargs ls -lha

lrwxr-xr-x  1 zach.shipley  staff    58B Feb  2 11:28 testrunner/platforms/android/src/com/mutualmobile/cordova/bluetoothle/BluetoothLePlugin.java -> ../../../../../../../../src/android/BluetoothLePlugin.java
lrwxr-xr-x  1 zach.shipley  staff    52B Feb  2 11:28 testrunner/platforms/android/src/com/mutualmobile/cordova/bluetoothle/JSONObjects.java -> ../../../../../../../../src/android/JSONObjects.java
```

So updating them from Android Studio will update the plugin files in the src/
directory. We do it this way to avoid version-controlling the entire
testrunner/ directory (the vast majority of which is code we did not write and
is generated by the `./build` script).

### Running

1. Make sure `./server` is running in a Terminal window
2. Plug an Android device running at least Android 4.3 in to your computer
3. Click Run -> Run 'android' from the main Android Studio menu


Web/JavaScript Development
--------------------------

### Dependencies

Follow the same directions under "iOS Development" -> "Dependencies" or
"Android Development" -> "Dependencies".

### Relevant Files

The JavaScript component of the com.mutualmobile.cordova.bluetoothle plugin is
located in:

- src/www/bluetoothle.js

The Android and iOS test runner apps are both configured to load
`http://<your-ip-address>:8000/test/index.html`, which references the above .js
file.

### Running

1. Make sure `./server` is running in a Terminal window
2. Plug in an iOS or Android device
3. `./run`

### Workflow

The unit test code and the plugin's bluetoothle.js are running from a local web
server on your machine, so you can feel free to edit anything in the test/
directory or bluetoothle.js and simply refresh the app. No re-building
necessary, that is.  Just use `chrome://inspect` for Chrome remote debugging or
Safari's "Develop" menu to open a debugger, and hit Cmd+R to remotely refresh
the app.


The Test Runner App
-------------------

The BluetoothleTestRunner app is a very basic Cordova app. It contains one
Cordova plugin--this plugin--com.mutualmobile.cordova.bluetoothle. It does
nothing by itself, but loads `http://<your-ip-address>:8000/test/index.html`.

When you run `./server`, two servers are spawned:

1. An HTTP server running on port 8000 which serves test/index.html and its
   dependencies
2. A Bluetooth GATT server defined in `<path-to-project>/simulator/server.js`

When you launch the BluetoothleTestRunner app it loads test/index.html, which
runs the unit tests in test/js/test.js, which communicate over BLE (using the
plugin) with the GATT server. The tests will run over and over until an error
is encountered.

So whenever you make a change to the plugin, a good rule of thumb would be to
run the app and aim for 2 or more passing iterations.
